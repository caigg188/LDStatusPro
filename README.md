<div align="center">
  <img src="https://mypbres.s3.bitiful.net/favicon.svg" width="120" height="120" alt="LDStatus Pro Logo" />
  
  # 🚀 LDStatus Pro

> **Linux.do & IDCFlare 社区增强工具** - 信任级别追踪 · LD 士多 · 阅读统计 · 云同步 · 排行榜

![Version](https://img.shields.io/badge/version-v3.5.4.6-blue)
![License](https://img.shields.io/badge/license-MIT-green)
![Tampermonkey](https://img.shields.io/badge/Tampermonkey-✓-brightgreen)
![Multi-Site](https://img.shields.io/badge/Multi--Site-✓-brightgreen)
![Mobile](https://img.shields.io/badge/Mobile-✓-brightgreen)
![Code Size](https://img.shields.io/github/languages/code-size/caigg188/LDStatusPro)
![Stars](https://img.shields.io/github/stars/caigg188/LDStatusPro?style=flat)

🌐 **[官网](https://ldspro.qzz.io/)** | 📖 **[详细文档](./DOCS.md)** | 🔄 **[更新日志](./update_log.md)**

**简体中文** | [English](./README_EN.md) | [繁體中文](./README_TW.md)

</div>

---

## 🌟 核心功能

<table>
<tr>
<td width="50%">

### ☁️ 数据云同步

- **跨浏览器同步** - Chrome / Firefox / Edge / Safari
- **跨设备同步** - 电脑 / 笔记本 / 平板 / 手机
- **智能数据合并** - 自动取每天的较大值
- **365 天历史恢复** - 新设备自动恢复数据
- **升级要求历史同步** - 所有等级用户支持

</td>
<td width="50%">

### 🏆 阅读排行榜

- **三榜切换** - 日榜 / 周榜 / 月榜
- **Top 50** - 展示阅读时间前 50 名
- **隐私优先** - 自主选择是否加入
- **金银铜牌** - 前三名特殊展示
- **手动刷新** - 5 分钟冷却，各榜独立

</td>
</tr>
<tr>
<td>

### ⏱️ 阅读时间系统

- **最多 10 级阅读强度** - 渐进式成就体系
- **智能活跃检测** - 60 秒无操作自动暂停
- **动态视觉反馈** - 颜色随强度变化
- **服务端可配置** - 管理员可调整等级区间
- **本地缓存 24 小时** - 离线也能显示

</td>
<td>

### 📊 信任级别追踪

- **实时进度显示** - 直观的环形进度条
- **多维度统计** - 浏览/阅读/获赞/回复/发帖
- **智能变化标记** - 增减实时高亮
- **365 天趋势分析** - 热力图/折线图/柱状图
- **里程碑通知** - 5 级成就解锁提醒

</td>
</tr>
<tr>
<td>

### 🍉 吃瓜助手

- **AI 帖子总结** - 一键总结话题，简略/详细模式
- **追问对话** - 基于总结内容多轮问答
- **流式输出** - AI 回复实时显示
- **历史记录** - 保存总结，支持查看/复制/删除
- **自定义提示词** - 个性化 AI 行为

</td>
<td>

### 🍟 LDC 积分

- **余额查看** - 显示 credit.linux.do 积分
- **当日预估** - 基于 L 站积分变化预估收益
- **7 日统计** - 近一周收入/支出趋势图
- **交易记录** - 按时间/类型筛选
- **❤️ 赞赏支持** - 2/5/10/50 LDC 四档赞赏

</td>
</tr>
<tr>
<td>

### 📋 我的活动

- **已读历史** - 快速回顾浏览过的话题
- **收藏管理** - 一键查看所有收藏
- **回复记录** - 查看回复内容和时间
- **互动查看** - 查看 Discourse Reactions 记录
- **点赞历史** - 回顾赞过的内容
- **🔍 搜索功能** - 支持标题/标签搜索

</td>
<td>

### 🏪 LD 士多

- **兑换信息中心** - 虚拟物品和服务兑换平台
- **CDK 自动发放** - 兑换成功后自动获取卡密
- **分类浏览** - AI/存储/小鸡/咨询/订阅/接码/服务/小店
- **订单追踪** - 查看兑换记录和状态
- **商家入驻** - 绑定 LDC 账户发布兑换信息

</td>
</tr>
<tr>
<td>

### 🔑 CDK 面板

- **用户信息** - 头像、昵称、信任等级、CDK 分数
- **领取记录** - 查看已领取的 CDK 项目
- **项目详情** - 名称、描述、剩余数量、领取要求
- **一键复制** - 快速复制 CDK 内容
- **瀑布流加载** - 流畅的数据加载体验

</td>
<td>

### 🎫 反馈工单

- **便捷反馈** - 用户信息区一键提交工单
- **多种类型** - 功能建议 / BUG 反馈
- **双向沟通** - 支持用户与管理员回复
- **未读提醒** - 新回复红点提示

</td>
</tr>
</table>

---

## 🌐 支持站点

|     站点     | 信任级别 | 阅读统计 | 云同步 | 排行榜 |
| :----------: | :------: | :------: | :----: | :----: |
| **Linux.do** |    ✅    |    ✅    |   ✅   |   ✅   |
| **IDCFlare** |    ✅    |    ✅    |   ✅   |   ✅   |

> 两站点功能完全一致，独立 OAuth 认证，数据互不干扰

---

## 📱 全平台兼容

### 响应式设计

- **大屏优化** (≥1920px) - 面板宽度 340px，字体放大
- **中等屏幕** (≤768px) - 智能右对齐，280px 宽度
- **小屏设备** (≤480px) - 精简布局，260px 宽度
- **超矮屏** (≤500px) - 自动隐藏非必要元素

### 移动端支持

- ✅ 触摸拖拽移动面板
- ✅ 折叠状态下也可拖动
- ✅ 自适应字体和间距
- ✅ 优化的点击区域

---

## 🎨 UI/UX 设计

### 全新视觉体验

- 🎉 **100%完成度庆祝** - 进度达成时礼炮撒花动画
- ✨ **等级徽章动效** - 悬浮 360° 翻转 + 渐变流动
- 🌈 **等级专属配色** - Lv1 灰/Lv2 蓝/Lv3 紫青/Lv4 金橙红
- 🎨 **玻璃拟态设计** - 毛玻璃效果 + 发光边框
- 💫 **微交互动画** - 悬浮上浮/弹性缩放/阴影增强

### 主题系统

- 🌙 **深色主题** - 深邃背景 + 玻璃卡片
- ☀️ **浅色主题** - 透明白色系 + 优雅阴影
- 🔄 **一键切换** - 自动记忆用户偏好

---

## 🔐 安全与隐私

| 特性                | 说明                         |
| ------------------- | ---------------------------- |
| ✅ **本地存储**     | 数据存储在浏览器，不强制上传 |
| ✅ **OAuth 授权**   | 使用官方账号安全登录         |
| ✅ **XSS 防护**     | 前后端完整输入验证和转义     |
| ✅ **SQL 注入防护** | 统一使用参数化查询           |
| ✅ **自主选择**     | 云同步/排行榜可选参与        |
| ✅ **随时退出**     | 可退出排行榜或注销登录       |
| ✅ **数据隔离**     | 多账号/多站点独立存储        |

---

## ⚡ 快速开始

### 1. 安装脚本管理器

| 浏览器         | 推荐扩展     | 安装链接                                                                                               |
| -------------- | ------------ | ------------------------------------------------------------------------------------------------------ |
| Chrome/Edge    | Tampermonkey | [Chrome 商店](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobblkf) |
| Firefox        | Tampermonkey | [Firefox 商店](https://addons.mozilla.org/zh-CN/firefox/addon/tampermonkey/)                           |
| Safari (macOS) | Tampermonkey | [App Store](https://apps.apple.com/us/app/tampermonkey/id1482490089)                                   |
| Safari (iOS)   | Stay         | [App Store](https://apps.apple.com/app/stay-for-safari/id1591620171)                                   |

### 2. 安装脚本

| 安装方式           | 说明               | 链接                                                                                            |
| ------------------ | ------------------ | ----------------------------------------------------------------------------------------------- |
| 🚀 **GitHub 直装** | 最新版本，即时更新 | [**点击安装**](https://raw.githubusercontent.com/caigg188/LDStatusPro/main/LDStatusPro.user.js) |
| 📦 **GreasyFork**  | 备用源，自动同步   | [GreasyFork 页面](https://greasyfork.org/zh-CN/scripts/558575-ldstatus-pro)                     |

### 3. 开始使用

- 访问 [Linux.do](https://linux.do) 或 [IDCFlare](https://idcflare.com)
- 面板自动显示在页面右下角
- 点击登录启用云同步和排行榜
- 进入 LDC 积分面板访问「LD 士多」

---

## 📊 阅读等级系统

|   等级   | 图标 |     区间     | 颜色 |
| :------: | :--: | :----------: | :--: |
|  刚起步  |  🌱  |  0-30 分钟   | 灰色 |
|  热身中  |  📖  |  30-90 分钟  | 蓝色 |
| 渐入佳境 |  📚  | 90-180 分钟  | 绿色 |
| 沉浸阅读 |  🔥  | 180-300 分钟 | 黄色 |
| 深度学习 |  ⚡  | 300-450 分钟 | 橙色 |
| LD 达人  |  🏆  | 450-600 分钟 | 紫色 |
| 超级水怪 |  👑  |   600+分钟   | 粉色 |

> 💡 管理员可在后台「系统设置」中自定义等级区间和名称

---

## 🛠️ 技术架构

```
LDStatusPro/
├── LDStatusPro.user.js    # 客户端脚本 (Tampermonkey)
├── backend/               # 后端服务 (Cloudflare Workers)
│   ├── src/              # 源代码 (路由、服务、中间件)
│   ├── scripts/          # 数据库迁移脚本
│   ├── docs/             # API 文档
│   └── wrangler.toml     # Workers 配置
├── admin-panel/          # 管理面板 (Vue.js)
│   ├── src/              # 前端源码
│   ├── views/            # 页面组件
│   └── stores/           # Pinia 状态管理
├── website/              # 官网 (React + TypeScript)
│   ├── src/              # 源代码
│   └── hooks/            # 动态数据获取 Hook
└── docs/                 # 项目文档
    └── technicaDocs/     # 技术文档
```

### 技术栈

- **客户端**: 原生 JavaScript，零依赖，16000+ 行代码
- **后端**: Cloudflare Workers + D1 Database + R2 Storage
- **管理面板**: Vue 3 + Pinia + Vue Router 4 + Tailwind CSS
- **官网**: React 19 + TypeScript + Framer Motion + Tailwind CSS 4
- **认证**: OAuth 2.0 (超级管理员 + 子管理员双认证)

### 后端架构

- **缓存分层**: HTTP Cache → D1 Cache → Memory Buffer → D1 Tables
- **数据缓冲**: 智能批量写入，减少数据库压力
- **定时任务**: Cron Triggers 预计算排行榜
- **备份系统**: R2 对象存储，自动清理
- **安全防护**: 429 限流 + IP 黑名单 + 蜜罐检测

### 性能优化

- LRU 缓存历史数据聚合
- 批量写入合并存储操作
- API 响应缓存 + 请求去重 + 数据缓冲
- 异步渲染避免 UI 阻塞
- 指数退避重试机制
- 全局请求队列防止 429

---

## 📋 更新日志

### v3.5.4.x 🏪 LD 士多

**🏪 虚拟物品兑换信息中心**

- 💳 **LDC 积分兑换** - 使用 LDC 积分兑换虚拟物品和服务
- 📦 **CDK 自动发放** - 兑换成功后自动获取卡密，支持一键复制
- 👤 **商家入驻** - 绑定 LDC 账户发布兑换信息
- 📋 **订单追踪** - 查看兑换记录和状态
- 🔑 **CDK 管理** - 商家可批量添加、查看、复制 CDK

**🛡️ 安全加固**

- 🔒 XSS 防护增强 - 修复弹窗对话框中名称未转义的风险
- 🔐 CDK 竞态修复 - 使用原子 UPDATE 操作解决高并发问题
- 💉 SQL 注入防护 - 统一使用参数化查询

**🎨 UI/UX 优化**

- 🖼️ 详情页优化 - 图片 16:9 比例，描述区高度增加
- 📜 列表滚动记忆 - 返回列表时恢复滚动位置
- ⚠️ 拒绝/下架原因显示 - 我的发布中显示拒绝或下架原因

---

### v3.5.2.x 🔑 CDK 面板 & 请求优化

**🔑 新增 CDK 面板**

- 在 cdk.linux.do 页面集成 CDK 面板
- 查看用户信息、领取记录、项目详情

**⚡ 请求优化**

- 🚦 全局请求队列 - 300ms 最小间隔防止 429
- ⏱️ 429 限流冷却 - 2 分钟内不再发起新请求
- 💬 错误提示优化 - 智能识别错误类型，友好提示

---

### v3.5.0.x 🎉 核心功能

**✨ 吃瓜助手**

- 🍉 AI 帖子总结 / 📜 历史记录 / ✏️ 自定义提示词 / 💬 追问对话

**📋 我的活动**

- 📖 已读 / ⭐ 收藏 / 💬 回复 / ❤️ 赞过 / 📝 我的话题 / 🔍 搜索

**🍟 LDC 积分**

- 💰 积分余额 / 📊 7 日统计 / 📈 当日预估 / ❤️ 赞赏支持

[查看完整更新日志](./update_log.md)

---

## ❓ 常见问题 (FAQ)

<details>
<summary><b>❗ 面板不显示怎么办？</b></summary>

如果安装脚本后面板没有显示，请按以下步骤排查：

1. **启用浏览器开发者模式**

   - Chrome/Edge: 打开 `chrome://extensions/`，开启右上角「开发者模式」
   - Firefox: 打开 `about:debugging`，无需额外设置

2. **检查油猴扩展设置**

   - 点击 Tampermonkey 图标 → 管理面板
   - 找到 LDStatus Pro 脚本，确保已启用（开关为开启状态）
   - 进入「设置」→ 确保「允许用户脚本访问的权限」设置正确

3. **刷新页面**
   - 完成上述设置后，刷新 Linux.do 或 IDCFlare 页面
   - 面板应该会出现在页面右下角

> 💡 如果仍然不显示，尝试禁用其他可能冲突的扩展后重试

</details>

<details>
<summary><b>🦊 Firefox 浏览器登录失败怎么办？</b></summary>

部分 Firefox 用户可能因隐私设置导致 OAuth 登录失败（授权成功但面板无更新）。请尝试以下排查步骤：

1. **检查增强型追踪保护**

   - 打开 `about:preferences#privacy`
   - 如果设置为「严格」，尝试改为「标准」

2. **检查容器标签页** (如使用 Multi-Account Containers 扩展)

   - 确保授权弹窗和主页面在**同一个容器**中
   - 或暂时在「无容器」的普通标签页中登录

3. **检查第三方 Cookie 设置**
   - 确保没有完全禁用第三方 Cookie
   - 可在 `about:preferences#privacy` → 「Cookie 和网站数据」中检查

> 💡 Chrome、Edge 等浏览器通常不会有此问题

</details>

<details>
<summary><b>📊 阅读时间为什么不增加？</b></summary>

- 脚本检测鼠标移动、滚动、点击等活动
- **60 秒无操作**会自动暂停计时
- 恢复操作后会继续计时
</details>

<details>
<summary><b>☁️ 云同步数据会覆盖本地数据吗？</b></summary>

- 云同步采用**取较大值合并**策略
- 同一天的数据，保留本地和云端中的较大值
- 不会丢失任何已记录的阅读时间
</details>

<details>
<summary><b>🏪 如何在 LD士多发布兑换信息？</b></summary>

1. 打开 LDC 积分面板，切换到「LD 士多」标签
2. 点击「我的发布」→「商家设置」
3. 填写 LDC PID（从 credit.linux.do 个人页面获取）
4. 配置通知地址（可选，用于接收订单回调）
5. 保存后即可开始发布兑换信息
</details>

---

## ⭐ Star History

<a href="https://www.star-history.com/#caigg188/LDStatusPro&Date">
 <picture>
   <source media="(prefers-color-scheme: dark)" srcset="https://api.star-history.com/svg?repos=caigg188/LDStatusPro&type=Date&theme=dark" />
   <source media="(prefers-color-scheme: light)" srcset="https://api.star-history.com/svg?repos=caigg188/LDStatusPro&type=Date" />
   <img alt="Star History Chart" src="https://api.star-history.com/svg?repos=caigg188/LDStatusPro&type=Date" />
 </picture>
</a>

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

- 🐛 [报告问题](https://github.com/caigg188/LDStatusPro/issues)
- 💡 [功能建议](https://github.com/caigg188/LDStatusPro/issues)
- 📖 [详细文档](./DOCS.md)

---

## 📄 许可证

MIT License - 自由使用、修改和分发

---

<div align="center">

**Made with ❤️ for Linux.do Community**

[GitHub](https://github.com/caigg188/LDStatusPro) · [安装脚本](https://raw.githubusercontent.com/caigg188/LDStatusPro/main/LDStatusPro.user.js) · [反馈问题](https://github.com/caigg188/LDStatusPro/issues)

**⭐ 如果有帮助，请给个 Star！**

</div>
